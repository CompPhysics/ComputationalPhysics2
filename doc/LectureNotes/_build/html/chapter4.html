
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3. Work, Energy, Momentum and Conservation laws &#8212; Classical mechanics</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Harmonic Oscillator" href="chapter5.html" />
    <link rel="prev" title="2. Basic Steps of Scientific Investigations" href="chapter3.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Classical mechanics</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   PHY321, Classical Mechanics I, Michigan State University, Spring 2021
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Motion, Forces and Conservation Laws
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="chapter2.html">
   1. Space, Time, Motion, Reference Frames  and Reminder on vectors and other mathematical quantities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter3.html">
   2. Basic Steps of Scientific Investigations
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3. Work, Energy, Momentum and Conservation laws
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter5.html">
   4. Harmonic Oscillator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter6.html">
   5. Two-body Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter7.html">
   6. Non-inertial Frames, Translation and Rotating Coordinate Systems
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/chapter4.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#work-and-energy">
   3.1. Work and Energy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#energy-conservation">
   3.2. Energy Conservation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conservation-of-momentum">
   3.3. Conservation of Momentum
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conservation-of-angular-momentum">
   3.4. Conservation of Angular Momentum
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#symmetries-and-conservation-laws">
   3.5. Symmetries and Conservation Laws
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bulding-a-code-for-the-earth-sun-system">
   3.6. Bulding a code for the Earth-Sun system
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-a-code-for-the-solar-system-final-coupled-equations">
   3.7. Building a code for the solar system, final coupled equations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-a-code-for-the-solar-system-discretized-equations">
   3.8. Building a code for the solar system, discretized equations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-example-with-euler-s-method">
   3.9. Code Example with Euler’s Method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problems-with-euler-s-method">
   3.10. Problems with Euler’s Method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deriving-the-euler-cromer-method">
   3.11. Deriving the Euler-Cromer Method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deriving-the-velocity-verlet-method">
   3.12. Deriving the Velocity-Verlet Method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-velocity-verlet-method">
   3.13. The velocity Verlet method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-the-velocity-verlet-method">
   3.14. Adding the Velocity-Verlet Method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#studying-energy-conservation">
   3.15. Studying Energy Conservation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-integration">
   3.16. Numerical Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   3.17. Numerical Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#newton-cotes-quadrature-or-equal-step-methods">
   3.18. Newton-Cotes Quadrature or equal-step methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-philosophy-of-equal-step-methods">
   3.19. Basic philosophy of equal-step methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-algorithm-for-equal-step-methods">
   3.20. Simple algorithm for equal step methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   3.21. Simple algorithm for equal step methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-rectangle-method">
   3.22. The rectangle method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#truncation-error-for-the-rectangular-rule">
   3.23. Truncation error for the rectangular rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#codes-for-the-rectangular-rule">
   3.24. Codes for the Rectangular rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-trapezoidal-rule">
   3.25. The trapezoidal rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#error-in-the-trapezoidal-rule">
   3.26. Error in the trapezoidal rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#algorithm-for-the-trapezoidal-rule">
   3.27. Algorithm for the trapezoidal rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trapezoidal-rule">
   3.28. Trapezoidal Rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simpsons-rule">
   3.29. Simpsons’ rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simpson-s-rule">
   3.30. Simpson’s rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mathematical-expressions-for-the-truncation-error">
   3.31. Mathematical expressions for the truncation error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#algorithm-for-simpson-s-rule">
   3.32. Algorithm for Simpson’s rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-example">
   3.33. Code example
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="work-energy-momentum-and-conservation-laws">
<h1><span class="section-number">3. </span>Work, Energy, Momentum and Conservation laws<a class="headerlink" href="#work-energy-momentum-and-conservation-laws" title="Permalink to this headline">¶</a></h1>
<p>Energy conservation is most convenient as a strategy for addressing
problems where time does not appear. For example, a particle goes
from position <span class="math notranslate nohighlight">\(x_0\)</span> with speed <span class="math notranslate nohighlight">\(v_0\)</span>, to position <span class="math notranslate nohighlight">\(x_f\)</span>; what is its
new speed? However, it can also be applied to problems where time
does appear, such as in solving for the trajectory <span class="math notranslate nohighlight">\(x(t)\)</span>, or
equivalently <span class="math notranslate nohighlight">\(t(x)\)</span>.</p>
<div class="section" id="work-and-energy">
<h2><span class="section-number">3.1. </span>Work and Energy<a class="headerlink" href="#work-and-energy" title="Permalink to this headline">¶</a></h2>
<p>Material to be added here.</p>
</div>
<div class="section" id="energy-conservation">
<h2><span class="section-number">3.2. </span>Energy Conservation<a class="headerlink" href="#energy-conservation" title="Permalink to this headline">¶</a></h2>
<p>Energy is conserved in the case where the potential energy, <span class="math notranslate nohighlight">\(V(\boldsymbol{r})\)</span>, depends only on position, and not on time. The force is determined by <span class="math notranslate nohighlight">\(V\)</span>,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto1"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\boldsymbol{F}(\boldsymbol{r})=-\nabla V(\boldsymbol{r}).
\label{_auto1} \tag{1}
\end{equation}
\]</div>
<p>The net energy, <span class="math notranslate nohighlight">\(E=V+K\)</span> where <span class="math notranslate nohighlight">\(K\)</span> is the kinetic energy, is then conserved,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\frac{d}{dt}(K+V)&amp;=&amp;\frac{d}{dt}\left(\frac{m}{2}(v_x^2+v_y^2+v_z^2)+V(\boldsymbol{r})\right)\\
\nonumber
&amp;=&amp;m\left(v_x\frac{dv_x}{dt}+v_y\frac{dv_y}{dt}+v_z\frac{dv_z}{dt}\right)
+\partial_xV\frac{dx}{dt}+\partial_yV\frac{dy}{dt}+\partial_zV\frac{dz}{dt}\\
\nonumber
&amp;=&amp;v_xF_x+v_yF_y+v_zF_z-F_xv_x-F_yv_y-F_zv_z=0.
\end{eqnarray}
\end{split}\]</div>
<p>The same proof can be written more compactly with vector notation,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\frac{d}{dt}\left(\frac{m}{2}v^2+V(\boldsymbol{r})\right)
&amp;=&amp;m\boldsymbol{v}\cdot\dot{\boldsymbol{v}}+\nabla V(\boldsymbol{r})\cdot\dot{\boldsymbol{r}}\\
\nonumber
&amp;=&amp;\boldsymbol{v}\cdot\boldsymbol{F}-\boldsymbol{F}\cdot\boldsymbol{v}=0.
\end{eqnarray}
\end{split}\]</div>
<p>Inverting the expression for kinetic energy,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto2"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
v=\sqrt{2K/m}=\sqrt{2(E-V)/m},
\label{_auto2} \tag{2}
\end{equation}
\]</div>
<p>allows one to solve for the one-dimensional trajectory <span class="math notranslate nohighlight">\(x(t)\)</span>, by finding <span class="math notranslate nohighlight">\(t(x)\)</span>,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto3"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
t=\int_{x_0}^x \frac{dx'}{v(x')}=\int_{x_0}^x\frac{dx'}{\sqrt{2(E-V(x'))/m}}.
\label{_auto3} \tag{3}
\end{equation}
\]</div>
<p>Note this would be much more difficult in higher dimensions, because
you would have to determine which points, <span class="math notranslate nohighlight">\(x,y,z\)</span>, the particles might
reach in the trajectory, whereas in one dimension you can typically
tell by simply seeing whether the kinetic energy is positive at every
point between the old position and the new position.</p>
<p>Consider a simple harmonic oscillator potential, <span class="math notranslate nohighlight">\(V(x)=kx^2/2\)</span>, with a particle emitted from <span class="math notranslate nohighlight">\(x=0\)</span> with velocity <span class="math notranslate nohighlight">\(v_0\)</span>. Solve for the trajectory <span class="math notranslate nohighlight">\(t(x)\)</span>,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
t&amp;=&amp;\int_{0}^x \frac{dx'}{\sqrt{2(E-kx^2/2)/m}}\\
\nonumber
&amp;=&amp;\sqrt{m/k}\int_0^x~\frac{dx'}{\sqrt{x_{\rm max}^2-x^{\prime 2}}},~~~x_{\rm max}^2=2E/k.
\end{eqnarray}
\end{split}\]</div>
<p>Here <span class="math notranslate nohighlight">\(E=mv_0^2/2\)</span> and <span class="math notranslate nohighlight">\(x_{\rm max}\)</span> is defined as the maximum
displacement before the particle turns around. This integral is done
by the substitution <span class="math notranslate nohighlight">\(\sin\theta=x/x_{\rm max}\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
(k/m)^{1/2}t&amp;=&amp;\sin^{-1}(x/x_{\rm max}),\\
\nonumber
x&amp;=&amp;x_{\rm max}\sin\omega t,~~~\omega=\sqrt{k/m}.
\end{eqnarray}
\end{split}\]</div>
</div>
<div class="section" id="conservation-of-momentum">
<h2><span class="section-number">3.3. </span>Conservation of Momentum<a class="headerlink" href="#conservation-of-momentum" title="Permalink to this headline">¶</a></h2>
<p>Newton’s third law which we met earlier states that <strong>For every action there is an equal and opposite reaction</strong>, is more accurately stated as
<strong>If two bodies exert forces on each other, these forces are equal in magnitude and opposite in direction</strong>.</p>
<p>This means that for two bodies <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>, if the force on <span class="math notranslate nohighlight">\(i\)</span> due to <span class="math notranslate nohighlight">\(j\)</span> is called <span class="math notranslate nohighlight">\(\boldsymbol{F}_{ij}\)</span>, then</p>
<!-- Equation labels as ordinary links -->
<div id="_auto4"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\boldsymbol{F}_{ij}=-\boldsymbol{F}_{ji}. 
\label{_auto4} \tag{4}
\end{equation}
\]</div>
<p>Newton’s second law, <span class="math notranslate nohighlight">\(\boldsymbol{F}=m\boldsymbol{a}\)</span>, can be written for a particle <span class="math notranslate nohighlight">\(i\)</span> as</p>
<!-- Equation labels as ordinary links -->
<div id="_auto5"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\boldsymbol{F}_i=\sum_{j\ne i} \boldsymbol{F}_{ij}=m_i\boldsymbol{a}_i,
\label{_auto5} \tag{5}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{F}_i\)</span> (a single subscript) denotes the net force acting on <span class="math notranslate nohighlight">\(i\)</span>. Because the mass of <span class="math notranslate nohighlight">\(i\)</span> is fixed, one can see that</p>
<!-- Equation labels as ordinary links -->
<div id="_auto6"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\boldsymbol{F}_i=\frac{d}{dt}m_i\boldsymbol{v}_i=\sum_{j\ne i}\boldsymbol{F}_{ij}.
\label{_auto6} \tag{6}
\end{equation}
\]</div>
<p>Now, one can sum over all the particles and obtain</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\frac{d}{dt}\sum_i m_iv_i&amp;=&amp;\sum_{ij, i\ne j}\boldsymbol{F}_{ij}\\
\nonumber
&amp;=&amp;0.
\end{eqnarray}
\end{split}\]</div>
<p>The last step made use of the fact that for every term <span class="math notranslate nohighlight">\(ij\)</span>, there is
an equivalent term <span class="math notranslate nohighlight">\(ji\)</span> with opposite force. Because the momentum is
defined as <span class="math notranslate nohighlight">\(m\boldsymbol{v}\)</span>, for a system of particles,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto7"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\frac{d}{dt}\sum_im_i\boldsymbol{v}_i=0,~~{\rm for~isolated~particles}.
\label{_auto7} \tag{7}
\end{equation}
\]</div>
<p>By “isolated” one means that the only force acting on any particle <span class="math notranslate nohighlight">\(i\)</span>
are those originating from other particles in the sum, i.e. “no
external” forces. Thus, Newton’s third law leads to the conservation
of total momentum,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\boldsymbol{P}&amp;=&amp;\sum_i m_i\boldsymbol{v}_i,\\
\nonumber
\frac{d}{dt}\boldsymbol{P}&amp;=&amp;0.
\end{eqnarray}
\end{split}\]</div>
<p>Consider the rocket of mass <span class="math notranslate nohighlight">\(M\)</span> moving with velocity <span class="math notranslate nohighlight">\(v\)</span>. After a
brief instant, the velocity of the rocket is <span class="math notranslate nohighlight">\(v+\Delta v\)</span> and the mass
is <span class="math notranslate nohighlight">\(M-\Delta M\)</span>. Momentum conservation gives</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray*}
Mv&amp;=&amp;(M-\Delta M)(v+\Delta v)+\Delta M(v-v_e)\\
0&amp;=&amp;-\Delta Mv+M\Delta v+\Delta M(v-v_e),\\
0&amp;=&amp;M\Delta v-\Delta Mv_e.
\end{eqnarray*}
\end{split}\]</div>
<p>In the second step we ignored the term <span class="math notranslate nohighlight">\(\Delta M\Delta v\)</span> because it is doubly small. The last equation gives</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\Delta v&amp;=&amp;\frac{v_e}{M}\Delta M,\\
\nonumber
\frac{dv}{dt}&amp;=&amp;\frac{v_e}{M}\frac{dM}{dt}.
\end{eqnarray}
\end{split}\]</div>
<p>Integrating the expression with lower limits <span class="math notranslate nohighlight">\(v_0=0\)</span> and <span class="math notranslate nohighlight">\(M_0\)</span>, one finds</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray*}
v&amp;=&amp;v_e\int_{M_0}^M \frac{dM'}{M'}\\
v&amp;=&amp;-v_e\ln(M/M_0)\\
&amp;=&amp;-v_e\ln[(M_0-\alpha t)/M_0].
\end{eqnarray*}
\end{split}\]</div>
<p>Because the total momentum of an isolated system is constant, one can
also quickly see that the center of mass of an isolated system is also
constant. The center of mass is the average position of a set of
masses weighted by the mass,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto8"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\bar{x}=\frac{\sum_im_ix_i}{\sum_i m_i}.
\label{_auto8} \tag{8}
\end{equation}
\]</div>
<p>The rate of change of <span class="math notranslate nohighlight">\(\bar{x}\)</span> is</p>
<div class="math notranslate nohighlight">
\[
\begin{eqnarray}
\dot{\bar{x}}&amp;=&amp;\frac{1}{M}\sum_i m_i\dot{x}_i=\frac{1}{M}P_x.
\end{eqnarray}
\]</div>
<p>Thus if the total momentum is constant the center of mass moves at a
constant velocity, and if the total momentum is zero the center of
mass is fixed.</p>
</div>
<div class="section" id="conservation-of-angular-momentum">
<h2><span class="section-number">3.4. </span>Conservation of Angular Momentum<a class="headerlink" href="#conservation-of-angular-momentum" title="Permalink to this headline">¶</a></h2>
<p>Consider a case where the force always points radially,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto9"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\boldsymbol{F}(\boldsymbol{r})=F(r)\hat{r},
\label{_auto9} \tag{9}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{r}\)</span> is a unit vector pointing outward from the origin. The angular momentum is defined as</p>
<!-- Equation labels as ordinary links -->
<div id="_auto10"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\boldsymbol{L}=\boldsymbol{r}\times\boldsymbol{p}=m\boldsymbol{r}\times\boldsymbol{v}.
\label{_auto10} \tag{10}
\end{equation}
\]</div>
<p>The rate of change of the angular momentum is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\frac{d\boldsymbol{L}}{dt}&amp;=&amp;m\boldsymbol{v}\times\boldsymbol{v}+m\boldsymbol{r}\times\dot{\boldsymbol{v}}\\
\nonumber
&amp;=&amp;m\boldsymbol{v}\times\boldsymbol{v}+\boldsymbol{r}\times{\boldsymbol{F}}=0.
\end{eqnarray}
\end{split}\]</div>
<p>The first term is zero because <span class="math notranslate nohighlight">\(\boldsymbol{v}\)</span> is parallel to itself, and the
second term is zero because <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span> is parallel to <span class="math notranslate nohighlight">\(\boldsymbol{r}\)</span>.</p>
<p>As an aside, one can see from the Levi-Civita symbol that the cross
product of a vector with itself is zero. Here, we consider a vector</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\boldsymbol{V}&amp;=&amp;\boldsymbol{A}\times\boldsymbol{A},\\
\nonumber
V_i&amp;=&amp;(\boldsymbol{A}\times\boldsymbol{A})_i=\sum_{jk}\epsilon_{ijk}A_jA_k.
\end{eqnarray}
\end{split}\]</div>
<p>For any term <span class="math notranslate nohighlight">\(i\)</span>, there are two contributions. For example, for <span class="math notranslate nohighlight">\(i\)</span>
denoting the <span class="math notranslate nohighlight">\(x\)</span> direction, either <span class="math notranslate nohighlight">\(j\)</span> denotes the <span class="math notranslate nohighlight">\(y\)</span> direction and
<span class="math notranslate nohighlight">\(k\)</span> denotes the <span class="math notranslate nohighlight">\(z\)</span> direction, or vice versa, so</p>
<!-- Equation labels as ordinary links -->
<div id="_auto11"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
V_1=\epsilon_{123}A_2A_3+\epsilon_{132}A_3A_2.
\label{_auto11} \tag{11}
\end{equation}
\]</div>
<p>This is zero by the antisymmetry of <span class="math notranslate nohighlight">\(\epsilon\)</span> under permutations.</p>
<p>If the force is not radial, <span class="math notranslate nohighlight">\(\boldsymbol{r}\times\boldsymbol{F}\ne 0\)</span> as above, and angular momentum is no longer conserved,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto12"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\frac{d\boldsymbol{L}}{dt}=\boldsymbol{r}\times\boldsymbol{F}\equiv\boldsymbol{\tau},
\label{_auto12} \tag{12}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{\tau}\)</span> is the torque.</p>
<p>For a system of isolated particles, one can write</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\frac{d}{dt}\sum_i\boldsymbol{L}_i&amp;=&amp;\sum_{i\ne j}\boldsymbol{r}_i\times \boldsymbol{F}_{ij}\\
\nonumber
&amp;=&amp;\frac{1}{2}\sum_{i\ne j} \boldsymbol{r}_i\times \boldsymbol{F}_{ij}+\boldsymbol{r}_j\times\boldsymbol{F}_{ji}\\
\nonumber
&amp;=&amp;\frac{1}{2}\sum_{i\ne j} (\boldsymbol{r}_i-\boldsymbol{r}_j)\times\boldsymbol{F}_{ij}=0,
\end{eqnarray}
\end{split}\]</div>
<p>where the last step used Newton’s third law,
<span class="math notranslate nohighlight">\(\boldsymbol{F}_{ij}=-\boldsymbol{F}_{ji}\)</span>. If the forces between the particles are
radial, i.e. <span class="math notranslate nohighlight">\(\boldsymbol{F}_{ij} ~||~ (\boldsymbol{r}_i-\boldsymbol{r}_j)\)</span>, then each term in
the sum is zero and the net angular momentum is fixed. Otherwise, you
could imagine an isolated system that would start spinning
spontaneously.</p>
<p>One can write the torque about a given axis, which we will denote as <span class="math notranslate nohighlight">\(\hat{z}\)</span>, in polar coordinates, where</p>
<div class="math notranslate nohighlight">
\[
\begin{eqnarray}
x&amp;=&amp;r\sin\theta\cos\phi,~~y=r\sin\theta\cos\phi,~~z=r\cos\theta,
\end{eqnarray}
\]</div>
<p>to find the <span class="math notranslate nohighlight">\(z\)</span> component of the torque,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\tau_z&amp;=&amp;xF_y-yF_x\\
\nonumber
&amp;=&amp;-r\sin\theta\left\{\cos\phi \partial_y-\sin\phi \partial_x\right\}V(x,y,z).
\end{eqnarray}
\end{split}\]</div>
<p>One can use the chain rule to write the partial derivative w.r.t. <span class="math notranslate nohighlight">\(\phi\)</span> (keeping <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(\theta\)</span> fixed),</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\partial_\phi&amp;=&amp;\frac{\partial x}{\partial\phi}\partial_x+\frac{\partial_y}{\partial\phi}\partial_y
+\frac{\partial z}{\partial\phi}\partial_z\\
\nonumber
&amp;=&amp;-r\sin\theta\sin\phi\partial_x+\sin\theta\cos\phi\partial_y.
\end{eqnarray}
\end{split}\]</div>
<p>Combining the two equations,</p>
<div class="math notranslate nohighlight">
\[
\begin{eqnarray}
\tau_z&amp;=&amp;-\partial_\phi V(r,\theta,\phi).
\end{eqnarray}
\]</div>
<p>Thus, if the potential is independent of the azimuthal angle <span class="math notranslate nohighlight">\(\phi\)</span>,
there is no torque about the <span class="math notranslate nohighlight">\(z\)</span> axis and <span class="math notranslate nohighlight">\(L_z\)</span> is conserved.</p>
</div>
<div class="section" id="symmetries-and-conservation-laws">
<h2><span class="section-number">3.5. </span>Symmetries and Conservation Laws<a class="headerlink" href="#symmetries-and-conservation-laws" title="Permalink to this headline">¶</a></h2>
<p>When we derived the conservation of energy, we assumed that the
potential depended only on position, not on time. If it depended
explicitly on time, one can quickly see that the energy would have
changed at a rate <span class="math notranslate nohighlight">\(\partial_tV(x,y,z,t)\)</span>. Note that if there is no
explicit dependence on time, i.e. <span class="math notranslate nohighlight">\(V(x,y,z)\)</span>, the potential energy can
depend on time through the variations of <span class="math notranslate nohighlight">\(x,y,z\)</span> with time. However,
that variation does not lead to energy non-conservation. Further, we
just saw that if a potential does not depend on the azimuthal angle
about some axis, <span class="math notranslate nohighlight">\(\phi\)</span>, that the angular momentum about that axis is
conserved.</p>
<p>Now, we relate momentum conservation to translational
invariance. Considering a system of particles with positions,
<span class="math notranslate nohighlight">\(\boldsymbol{r}_i\)</span>, if one changed the coordinate system by a translation by a
differential distance <span class="math notranslate nohighlight">\(\boldsymbol{\epsilon}\)</span>, the net potential would change
by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\delta V(\boldsymbol{r}_1,\boldsymbol{r}_2\cdots)&amp;=&amp;\sum_i \boldsymbol{\epsilon}\cdot\nabla_i V(\boldsymbol{r}_1,\boldsymbol{r}_2,\cdots)\\
\nonumber
&amp;=&amp;-\sum_i \boldsymbol{\epsilon}\cdot\boldsymbol{F}_i\\
\nonumber
&amp;=&amp;-\frac{d}{dt}\sum_i \boldsymbol{\epsilon}\cdot\boldsymbol{p}_i.
\end{eqnarray}
\end{split}\]</div>
<p>Thus, if the potential is unchanged by a translation of the coordinate
system, the total momentum is conserved. If the potential is
translationally invariant in a given direction, defined by a unit
vector, <span class="math notranslate nohighlight">\(\hat{\epsilon}\)</span> in the <span class="math notranslate nohighlight">\(\boldsymbol{\epsilon}\)</span> direction, one can see
that</p>
<div class="math notranslate nohighlight">
\[
\begin{eqnarray}
\hat{\epsilon}\cdot\nabla_i V(\boldsymbol{r}_i)&amp;=&amp;0.
\end{eqnarray}
\]</div>
<p>The component of the total momentum along that axis is conserved. This
is rather obvious for a single particle. If <span class="math notranslate nohighlight">\(V(\boldsymbol{r})\)</span> does not
depend on some coordinate <span class="math notranslate nohighlight">\(x\)</span>, then the force in the <span class="math notranslate nohighlight">\(x\)</span> direction is
<span class="math notranslate nohighlight">\(F_x=-\partial_xV=0\)</span>, and momentum along the <span class="math notranslate nohighlight">\(x\)</span> direction is
constant.</p>
<p>We showed how the total momentum of an isolated system of particle was conserved, even if the particles feel internal forces in all directions. In that case the potential energy could be written</p>
<div class="math notranslate nohighlight">
\[
\begin{eqnarray}
V=\sum_{i,j\le i}V_{ij}(\boldsymbol{r}_i-\boldsymbol{r}_j).
\end{eqnarray}
\]</div>
<p>In this case, a translation leads to <span class="math notranslate nohighlight">\(\boldsymbol{r}_i\rightarrow
\boldsymbol{r}_i+\boldsymbol{\epsilon}\)</span>, with the translation equally affecting the
coordinates of each particle. Because the potential depends only on
the relative coordinates, <span class="math notranslate nohighlight">\(\delta V\)</span> is manifestly zero. If one were
to go through the exercise of calculating <span class="math notranslate nohighlight">\(\delta V\)</span> for small
<span class="math notranslate nohighlight">\(\boldsymbol{\epsilon}\)</span>, one would find that the term
<span class="math notranslate nohighlight">\(\nabla_i V(\boldsymbol{r}_i-\boldsymbol{r}_j)\)</span> would be canceled by the term
<span class="math notranslate nohighlight">\(\nabla_jV(\boldsymbol{r}_i-\boldsymbol{r}_j)\)</span>.</p>
<p>The relation between symmetries of the potential and conserved
quantities (also called constants of motion) is one of the most
profound concepts one should gain from this course. It plays a
critical role in all fields of physics. This is especially true in
quantum mechanics, where a quantity <span class="math notranslate nohighlight">\(A\)</span> is conserved if its operator
commutes with the Hamiltonian. For example if the momentum operator
<span class="math notranslate nohighlight">\(-i\hbar\partial_x\)</span> commutes with the Hamiltonian, momentum is
conserved, and clearly this operator commutes if the Hamiltonian
(which represents the total energy, not just the potential) does not
depend on <span class="math notranslate nohighlight">\(x\)</span>. Also in quantum mechanics the angular momentum operator
is <span class="math notranslate nohighlight">\(L_z=-i\hbar\partial_\phi\)</span>. In fact, if the potential is unchanged
by rotations about some axis, angular momentum about that axis is
conserved. We return to this concept, from a more formal perspective,
later in the course when Lagrangian mechanics is presented.</p>
</div>
<div class="section" id="bulding-a-code-for-the-earth-sun-system">
<h2><span class="section-number">3.6. </span>Bulding a code for the Earth-Sun system<a class="headerlink" href="#bulding-a-code-for-the-earth-sun-system" title="Permalink to this headline">¶</a></h2>
<p>We will now venture into a study of a system which is energy
conserving. The aim is to see if we (since it is not possible to solve
the general equations analytically) we can develop stable numerical
algorithms whose results we can trust!</p>
<p>We solve the equations of motion numerically. We will also compute
quantities like the energy numerically.</p>
<p>We start with a simpler case first, the Earth-Sun system  in two dimensions only.  The gravitational force <span class="math notranslate nohighlight">\(F_G\)</span> on the earth from the sun is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}_G=-\frac{GM_{\odot}M_E}{r^3}\boldsymbol{r},
\]</div>
<p>where <span class="math notranslate nohighlight">\(G\)</span> is the gravitational constant,</p>
<div class="math notranslate nohighlight">
\[
M_E=6\times 10^{24}\mathrm{Kg},
\]</div>
<p>the mass of Earth,</p>
<div class="math notranslate nohighlight">
\[
M_{\odot}=2\times 10^{30}\mathrm{Kg},
\]</div>
<p>the mass of the Sun and</p>
<div class="math notranslate nohighlight">
\[
r=1.5\times 10^{11}\mathrm{m},
\]</div>
<p>is the distance between Earth and the Sun. The latter defines what we call an astronomical unit <strong>AU</strong>.
From Newton’s second law we have then for the <span class="math notranslate nohighlight">\(x\)</span> direction</p>
<div class="math notranslate nohighlight">
\[
\frac{d^2x}{dt^2}=-\frac{F_{x}}{M_E},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{d^2y}{dt^2}=-\frac{F_{y}}{M_E},
\]</div>
<p>for the <span class="math notranslate nohighlight">\(y\)</span> direction.</p>
<p>Here we will use  that  <span class="math notranslate nohighlight">\(x=r\cos{(\theta)}\)</span>, <span class="math notranslate nohighlight">\(y=r\sin{(\theta)}\)</span> and</p>
<div class="math notranslate nohighlight">
\[
r = \sqrt{x^2+y^2}.
\]</div>
<p>We can rewrite</p>
<div class="math notranslate nohighlight">
\[
F_{x}=-\frac{GM_{\odot}M_E}{r^2}\cos{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}x,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_{y}=-\frac{GM_{\odot}M_E}{r^2}\sin{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}y,
\]</div>
<p>for the <span class="math notranslate nohighlight">\(y\)</span> direction.</p>
<p>We can rewrite these two equations</p>
<div class="math notranslate nohighlight">
\[
F_{x}=-\frac{GM_{\odot}M_E}{r^2}\cos{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}x,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_{y}=-\frac{GM_{\odot}M_E}{r^2}\sin{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}y,
\]</div>
<p>as four first-order coupled differential equations</p>
<p>4
3</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>4
4</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>4
5</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<div class="math notranslate nohighlight">
\[
\frac{dy}{dt}=v_y.
\]</div>
</div>
<div class="section" id="building-a-code-for-the-solar-system-final-coupled-equations">
<h2><span class="section-number">3.7. </span>Building a code for the solar system, final coupled equations<a class="headerlink" href="#building-a-code-for-the-solar-system-final-coupled-equations" title="Permalink to this headline">¶</a></h2>
<p>The four coupled differential equations</p>
<p>4
7</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>4
8</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>4
9</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<div class="math notranslate nohighlight">
\[
\frac{dy}{dt}=v_y,
\]</div>
<p>can be turned into dimensionless equations or we can introduce astronomical units with <span class="math notranslate nohighlight">\(1\)</span> AU = <span class="math notranslate nohighlight">\(1.5\times 10^{11}\)</span>.</p>
<p>Using the equations from circular motion (with <span class="math notranslate nohighlight">\(r =1\mathrm{AU}\)</span>)</p>
<div class="math notranslate nohighlight">
\[
\frac{M_E v^2}{r} = F = \frac{GM_{\odot}M_E}{r^2},
\]</div>
<p>we have</p>
<div class="math notranslate nohighlight">
\[
GM_{\odot}=v^2r,
\]</div>
<p>and using that the velocity of Earth (assuming circular motion) is
<span class="math notranslate nohighlight">\(v = 2\pi r/\mathrm{yr}=2\pi\mathrm{AU}/\mathrm{yr}\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[
GM_{\odot}= v^2r = 4\pi^2 \frac{(\mathrm{AU})^3}{\mathrm{yr}^2}.
\]</div>
</div>
<div class="section" id="building-a-code-for-the-solar-system-discretized-equations">
<h2><span class="section-number">3.8. </span>Building a code for the solar system, discretized equations<a class="headerlink" href="#building-a-code-for-the-solar-system-discretized-equations" title="Permalink to this headline">¶</a></h2>
<p>The four coupled differential equations can then be discretized using Euler’s method as (with step length <span class="math notranslate nohighlight">\(h\)</span>)</p>
<p>5
4</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>5
5</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>5
6</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<div class="math notranslate nohighlight">
\[
y_{i+1}=y_i+hv_{y,i},
\]</div>
</div>
<div class="section" id="code-example-with-euler-s-method">
<h2><span class="section-number">3.9. </span>Code Example with Euler’s Method<a class="headerlink" href="#code-example-with-euler-s-method" title="Permalink to this headline">¶</a></h2>
<p>The code here implements Euler’s method for the Earth-Sun system using a more compact way of representing the vectors. Alternatively, you could have spelled out all the variables <span class="math notranslate nohighlight">\(v_x\)</span>, <span class="math notranslate nohighlight">\(v_y\)</span>, <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> as one-dimensional arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Common imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Where to save the figures and data files</span>
<span class="n">PROJECT_ROOT_DIR</span> <span class="o">=</span> <span class="s2">&quot;Results&quot;</span>
<span class="n">FIGURE_ID</span> <span class="o">=</span> <span class="s2">&quot;Results/FigureFiles&quot;</span>
<span class="n">DATA_ID</span> <span class="o">=</span> <span class="s2">&quot;DataFiles/&quot;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">,</span> <span class="n">fig_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">data_path</span><span class="p">(</span><span class="n">dat_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">,</span> <span class="n">dat_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>


<span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># in years</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="c1"># Start integrating using Euler&#39;s method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up the acceleration</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update velocity, time and position using Euler&#39;s forward method</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">a</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1">#ax.set_xlim(0, tfinal)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;x[m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y[m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EarthSunEuler&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_108_0.png" src="_images/chapter4_108_0.png" />
</div>
</div>
</div>
<div class="section" id="problems-with-euler-s-method">
<h2><span class="section-number">3.10. </span>Problems with Euler’s Method<a class="headerlink" href="#problems-with-euler-s-method" title="Permalink to this headline">¶</a></h2>
<p>We notice here that Euler’s method doesn’t give a stable orbit. It
means that we cannot trust Euler’s method. In a deeper way, as we will
see in homework 5, Euler’s method does not conserve energy. It is an
example of an integrator which is not
<a class="reference external" href="https://en.wikipedia.org/wiki/Symplectic_integrator">symplectic</a>.</p>
<p>Here we present thus two methods, which with simple changes allow us to avoid these pitfalls. The simplest possible extension is the so-called Euler-Cromer method.
The changes we need to make to our code are indeed marginal here.
We need simply to replace</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>in the above code with the velocity at the new time <span class="math notranslate nohighlight">\(t_{i+1}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>By this simple caveat we get stable orbits.
Below we derive the Euler-Cromer method as well as one of the most utlized algorithms for sovling the above type of problems, the so-called Velocity-Verlet method.</p>
</div>
<div class="section" id="deriving-the-euler-cromer-method">
<h2><span class="section-number">3.11. </span>Deriving the Euler-Cromer Method<a class="headerlink" href="#deriving-the-euler-cromer-method" title="Permalink to this headline">¶</a></h2>
<p>Let us repeat Euler’s method.
We have a differential equation</p>
<!-- Equation labels as ordinary links -->
<div id="_auto13"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
y'(t_i)=f(t_i,y_i)   
\label{_auto13} \tag{13}
\end{equation}
\]</div>
<p>and if we truncate at the first derivative, we have from the Taylor expansion</p>
<!-- Equation labels as ordinary links -->
<div id="eq:euler"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
y_{i+1}=y(t_i) + (\Delta t) f(t_i,y_i) + O(\Delta t^2), \label{eq:euler} \tag{14}
\end{equation}
\]</div>
<p>which when complemented with <span class="math notranslate nohighlight">\(t_{i+1}=t_i+\Delta t\)</span> forms
the algorithm for the well-known Euler method.
Note that at every step we make an approximation error
of the order of <span class="math notranslate nohighlight">\(O(\Delta t^2)\)</span>, however the total error is the sum over all
steps <span class="math notranslate nohighlight">\(N=(b-a)/(\Delta t)\)</span> for <span class="math notranslate nohighlight">\(t\in [a,b]\)</span>, yielding thus a global error which goes like
<span class="math notranslate nohighlight">\(NO(\Delta t^2)\approx O(\Delta t)\)</span>.</p>
<p>To make Euler’s method more precise we can obviously
decrease <span class="math notranslate nohighlight">\(\Delta t\)</span> (increase <span class="math notranslate nohighlight">\(N\)</span>), but this can lead to loss of numerical precision.
Euler’s method is not recommended for precision calculation,
although it is handy to use in order to get a first
view on how a solution may look like.</p>
<p>Euler’s method is asymmetric in time, since it uses information about the derivative at the beginning
of the time interval. This means that we evaluate the position at <span class="math notranslate nohighlight">\(y_1\)</span> using the velocity
at <span class="math notranslate nohighlight">\(v_0\)</span>. A simple variation is to determine <span class="math notranslate nohighlight">\(x_{n+1}\)</span> using the velocity at
<span class="math notranslate nohighlight">\(v_{n+1}\)</span>, that is (in a slightly more generalized form)</p>
<!-- Equation labels as ordinary links -->
<div id="_auto14"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation} 
y_{n+1}=y_{n}+ v_{n+1}+O(\Delta t^2)
\label{_auto14} \tag{15}
\end{equation}
\]</div>
<p>and</p>
<!-- Equation labels as ordinary links -->
<div id="_auto15"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
v_{n+1}=v_{n}+(\Delta t) a_{n}+O(\Delta t^2).
\label{_auto15} \tag{16}
\end{equation}
\]</div>
<p>The acceleration <span class="math notranslate nohighlight">\(a_n\)</span> is a function of <span class="math notranslate nohighlight">\(a_n(y_n, v_n, t_n)\)</span> and needs to be evaluated
as well. This is the Euler-Cromer method.</p>
<p><strong>Exercise</strong>: go back to the above code with Euler’s method and add the Euler-Cromer method.</p>
</div>
<div class="section" id="deriving-the-velocity-verlet-method">
<h2><span class="section-number">3.12. </span>Deriving the Velocity-Verlet Method<a class="headerlink" href="#deriving-the-velocity-verlet-method" title="Permalink to this headline">¶</a></h2>
<p>Let us stay with <span class="math notranslate nohighlight">\(x\)</span> (position) and <span class="math notranslate nohighlight">\(v\)</span> (velocity) as the quantities we are interested in.</p>
<p>We have the Taylor expansion for the position given by</p>
<div class="math notranslate nohighlight">
\[
x_{i+1} = x_i+(\Delta t)v_i+\frac{(\Delta t)^2}{2}a_i+O((\Delta t)^3).
\]</div>
<p>The corresponding expansion for the velocity is</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+(\Delta t)a_i+\frac{(\Delta t)^2}{2}v^{(2)}_i+O((\Delta t)^3).
\]</div>
<p>Via Newton’s second law we have normally an analytical expression for the derivative of the velocity, namely</p>
<div class="math notranslate nohighlight">
\[
a_i= \frac{d^2 x}{dt^2}\vert_{i}=\frac{d v}{dt}\vert_{i}= \frac{F(x_i,v_i,t_i)}{m}.
\]</div>
<p>If we add to this the corresponding expansion for the derivative of the velocity</p>
<div class="math notranslate nohighlight">
\[
v^{(1)}_{i+1} = a_{i+1}= a_i+(\Delta t)v^{(2)}_i+O((\Delta t)^2)=a_i+(\Delta t)v^{(2)}_i+O((\Delta t)^2),
\]</div>
<p>and retain only terms up to the second derivative of the velocity since our error goes as <span class="math notranslate nohighlight">\(O(h^3)\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[
(\Delta t)v^{(2)}_i\approx a_{i+1}-a_i.
\]</div>
<p>We can then rewrite the Taylor expansion for the velocity as</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+\frac{(\Delta t)}{2}\left( a_{i+1}+a_{i}\right)+O((\Delta t)^3).
\]</div>
</div>
<div class="section" id="the-velocity-verlet-method">
<h2><span class="section-number">3.13. </span>The velocity Verlet method<a class="headerlink" href="#the-velocity-verlet-method" title="Permalink to this headline">¶</a></h2>
<p>Our final equations for the position and the velocity become then</p>
<div class="math notranslate nohighlight">
\[
x_{i+1} = x_i+(\Delta t)v_i+\frac{(\Delta t)^2}{2}a_{i}+O((\Delta t)^3),
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+\frac{(\Delta t)}{2}\left(a_{i+1}+a_{i}\right)+O((\Delta t)^3).
\]</div>
<p>Note well that the term <span class="math notranslate nohighlight">\(a_{i+1}\)</span> depends on the position at <span class="math notranslate nohighlight">\(x_{i+1}\)</span>. This means that you need to calculate
the position at the updated time <span class="math notranslate nohighlight">\(t_{i+1}\)</span> before the computing the next velocity.  Note also that the derivative of the velocity at the time
<span class="math notranslate nohighlight">\(t_i\)</span> used in the updating of the position can be reused in the calculation of the velocity update as well.</p>
</div>
<div class="section" id="adding-the-velocity-verlet-method">
<h2><span class="section-number">3.14. </span>Adding the Velocity-Verlet Method<a class="headerlink" href="#adding-the-velocity-verlet-method" title="Permalink to this headline">¶</a></h2>
<p>We can now easily add the Verlet method to our original code as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="c1"># Start integrating using the Velocity-Verlet  method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up forces, air resistance FD, note now that we need the norm of the vecto</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update velocity, time and position using the Velocity-Verlet method</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">DeltaT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">anew</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">DeltaT</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">anew</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;x[m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y[m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EarthSunVV&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_138_0.png" src="_images/chapter4_138_0.png" />
</div>
</div>
<p>You can easily generalize the calculation of the forces by defining a function
which takes in as input the various variables. We leave this as a challenge to you.</p>
</div>
<div class="section" id="studying-energy-conservation">
<h2><span class="section-number">3.15. </span>Studying Energy Conservation<a class="headerlink" href="#studying-energy-conservation" title="Permalink to this headline">¶</a></h2>
<p>In order to study the conservation of energy, we will need to perform
a numerical integration, unless we can integrate analytically. Here we
present the Trapezoidal rule as a the simplest possible approximation.</p>
</div>
<div class="section" id="numerical-integration">
<h2><span class="section-number">3.16. </span>Numerical Integration<a class="headerlink" href="#numerical-integration" title="Permalink to this headline">¶</a></h2>
<p>It is also useful to consider methods to integrate numerically.
Let us consider the following case.
We have  classical electron which moves in the <span class="math notranslate nohighlight">\(x\)</span>-direction along a surface. The force from the surface is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}(x)=-F_0\sin{(\frac{2\pi x}{b})}\boldsymbol{e}_x.
\]</div>
<p>The constant <span class="math notranslate nohighlight">\(b\)</span> represents the distance between atoms at the surface of the material, <span class="math notranslate nohighlight">\(F_0\)</span> is a constant and <span class="math notranslate nohighlight">\(x\)</span> is the position of the electron.
Using the work-energy theorem we can find the work <span class="math notranslate nohighlight">\(W\)</span> done when moving an electron from a position <span class="math notranslate nohighlight">\(x_0\)</span> to a final position <span class="math notranslate nohighlight">\(x\)</span> through the
integral</p>
<div class="math notranslate nohighlight">
\[
W=-\int_{x_0}^x \boldsymbol{F}(x')dx' =  \int_{x_0}^x F_0\sin{(\frac{2\pi x'}{b})} dx',
\]</div>
<p>which results in</p>
<div class="math notranslate nohighlight">
\[
W=\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right].
\]</div>
</div>
<div class="section" id="id1">
<h2><span class="section-number">3.17. </span>Numerical Integration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>There are several numerical algorithms for finding an integral
numerically. The more familiar ones like the rectangular rule or the
trapezoidal rule have simple geometric interpretations.</p>
<p>Let us look at the mathematical details of what are called equal-step methods, also known as Newton-Cotes quadrature.</p>
</div>
<div class="section" id="newton-cotes-quadrature-or-equal-step-methods">
<h2><span class="section-number">3.18. </span>Newton-Cotes Quadrature or equal-step methods<a class="headerlink" href="#newton-cotes-quadrature-or-equal-step-methods" title="Permalink to this headline">¶</a></h2>
<p>The integral</p>
<!-- Equation labels as ordinary links -->
<div id="eq:integraldef"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
   I=\int_a^bf(x) dx
\label{eq:integraldef} \tag{17}
\end{equation}
\]</div>
<p>has a very simple meaning. The integral is the
area enscribed by the function <span class="math notranslate nohighlight">\(f(x)\)</span> starting from <span class="math notranslate nohighlight">\(x=a\)</span> to  <span class="math notranslate nohighlight">\(x=b\)</span>. It is subdivided in several smaller areas whose evaluation is to  be approximated by different techniques. The areas under the curve can for example  be approximated by rectangular boxes or trapezoids.</p>
</div>
<div class="section" id="basic-philosophy-of-equal-step-methods">
<h2><span class="section-number">3.19. </span>Basic philosophy of equal-step methods<a class="headerlink" href="#basic-philosophy-of-equal-step-methods" title="Permalink to this headline">¶</a></h2>
<p>In considering equal step  methods, our basic approach is that of approximating
a function <span class="math notranslate nohighlight">\(f(x)\)</span> with a polynomial of at most
degree <span class="math notranslate nohighlight">\(N-1\)</span>, given <span class="math notranslate nohighlight">\(N\)</span> integration points. If our polynomial is of degree <span class="math notranslate nohighlight">\(1\)</span>,
the function will be approximated with <span class="math notranslate nohighlight">\(f(x)\approx a_0+a_1x\)</span>.</p>
</div>
<div class="section" id="simple-algorithm-for-equal-step-methods">
<h2><span class="section-number">3.20. </span>Simple algorithm for equal step methods<a class="headerlink" href="#simple-algorithm-for-equal-step-methods" title="Permalink to this headline">¶</a></h2>
<p>The algorithm for these integration methods  is rather simple, and the number of approximations perhaps  unlimited!</p>
<ul class="simple">
<li><p>Choose a step size <span class="math notranslate nohighlight">\(h=(b-a)/N\)</span>  where <span class="math notranslate nohighlight">\(N\)</span> is the number of steps and <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> the lower and upper limits of integration.</p></li>
<li><p>With a given step length we rewrite the integral as</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x) dx= \int_a^{a+h}f(x)dx + \int_{a+h}^{a+2h}f(x)dx+\dots \int_{b-h}^{b}f(x)dx.
\]</div>
<ul class="simple">
<li><p>The strategy then is to find a reliable polynomial approximation   for <span class="math notranslate nohighlight">\(f(x)\)</span> in the various intervals.  Choosing a given approximation for  <span class="math notranslate nohighlight">\(f(x)\)</span>, we obtain a specific approximation to the  integral.</p></li>
<li><p>With this approximation to <span class="math notranslate nohighlight">\(f(x)\)</span> we perform the integration by computing the integrals over all subintervals.</p></li>
</ul>
</div>
<div class="section" id="id2">
<h2><span class="section-number">3.21. </span>Simple algorithm for equal step methods<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>One possible strategy then is to find a reliable polynomial expansion for <span class="math notranslate nohighlight">\(f(x)\)</span> in the smaller
subintervals. Consider for example evaluating</p>
<div class="math notranslate nohighlight">
\[
\int_a^{a+2h}f(x)dx,
\]</div>
<p>which we rewrite as</p>
<!-- Equation labels as ordinary links -->
<div id="eq:hhint"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\int_a^{a+2h}f(x)dx=\int_{x_0-h}^{x_0+h}f(x)dx.
\label{eq:hhint} \tag{18}
\end{equation}
\]</div>
<p>We have chosen a midpoint <span class="math notranslate nohighlight">\(x_0\)</span> and have defined <span class="math notranslate nohighlight">\(x_0=a+h\)</span>.</p>
</div>
<div class="section" id="the-rectangle-method">
<h2><span class="section-number">3.22. </span>The rectangle method<a class="headerlink" href="#the-rectangle-method" title="Permalink to this headline">¶</a></h2>
<p>A very simple approach is the so-called midpoint or rectangle method.
In this case the integration area is split in a given number of rectangles with length <span class="math notranslate nohighlight">\(h\)</span> and height given by the mid-point value of the function.  This gives the following simple rule for approximating an integral</p>
<!-- Equation labels as ordinary links -->
<div id="eq:rectangle"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
I=\int_a^bf(x) dx \approx  h\sum_{i=1}^N f(x_{i-1/2}), 
\label{eq:rectangle} \tag{19}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(f(x_{i-1/2})\)</span> is the midpoint value of <span class="math notranslate nohighlight">\(f\)</span> for a given rectangle. We will discuss its truncation
error below.  It is easy to implement this algorithm,  as shown below</p>
</div>
<div class="section" id="truncation-error-for-the-rectangular-rule">
<h2><span class="section-number">3.23. </span>Truncation error for the rectangular rule<a class="headerlink" href="#truncation-error-for-the-rectangular-rule" title="Permalink to this headline">¶</a></h2>
<p>The correct mathematical expression for the local error for the rectangular rule <span class="math notranslate nohighlight">\(R_i(h)\)</span> for element <span class="math notranslate nohighlight">\(i\)</span> is</p>
<div class="math notranslate nohighlight">
\[
\int_{-h}^hf(x)dx - R_i(h)=-\frac{h^3}{24}f^{(2)}(\xi),
\]</div>
<p>and the global error reads</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -R_h(f)=-\frac{b-a}{24}h^2f^{(2)}(\xi),
\]</div>
<p>where <span class="math notranslate nohighlight">\(R_h\)</span> is the result obtained with rectangular rule and <span class="math notranslate nohighlight">\(\xi \in [a,b]\)</span>.</p>
</div>
<div class="section" id="codes-for-the-rectangular-rule">
<h2><span class="section-number">3.24. </span>Codes for the Rectangular rule<a class="headerlink" href="#codes-for-the-rectangular-rule" title="Permalink to this headline">¶</a></h2>
<p>We go back to our simple example above and set <span class="math notranslate nohighlight">\(F_0=b=1\)</span> and choose <span class="math notranslate nohighlight">\(x_0=0\)</span> and <span class="math notranslate nohighlight">\(x=1/2\)</span>, and have</p>
<div class="math notranslate nohighlight">
\[
W=\frac{1}{\pi}.
\]</div>
<p>The code here computes the integral using the rectangle rule and <span class="math notranslate nohighlight">\(n=100\)</span> integration points we have a relative error of
<span class="math notranslate nohighlight">\(10^{-5}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">integrate</span>
<span class="c1"># function for the Rectangular rule                                                                                        </span>
<span class="k">def</span> <span class="nf">Rectangular</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
   <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
       <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">h</span>
       <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">h</span><span class="o">*</span><span class="n">s</span>
<span class="c1"># function to integrate</span>
<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># define integration limits and integration points                                                                         </span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">Exact</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relative error= &quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">Rectangular</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">Exact</span><span class="p">)</span><span class="o">/</span><span class="n">Exact</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Relative error=  4.112453549290521e-05
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-trapezoidal-rule">
<h2><span class="section-number">3.25. </span>The trapezoidal rule<a class="headerlink" href="#the-trapezoidal-rule" title="Permalink to this headline">¶</a></h2>
<p>The other integral gives</p>
<div class="math notranslate nohighlight">
\[
\int_{x_0-h}^{x_0}f(x)dx=\frac{h}{2}\left(f(x_0) + f(x_0-h)\right)+O(h^3),
\]</div>
<p>and adding up we obtain</p>
<!-- Equation labels as ordinary links -->
<div id="eq:trapez"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
   \int_{x_0-h}^{x_0+h}f(x)dx=\frac{h}{2}\left(f(x_0+h) + 2f(x_0) + f(x_0-h)\right)+O(h^3),
\label{eq:trapez} \tag{20}
\end{equation}
\]</div>
<p>which is the well-known trapezoidal rule.  Concerning the error in the approximation made,
<span class="math notranslate nohighlight">\(O(h^3)=O((b-a)^3/N^3)\)</span>, you should  note
that this is the local error.  Since we are splitting the integral from
<span class="math notranslate nohighlight">\(a\)</span> to <span class="math notranslate nohighlight">\(b\)</span> in <span class="math notranslate nohighlight">\(N\)</span> pieces, we will have to perform approximately <span class="math notranslate nohighlight">\(N\)</span>
such operations.</p>
<p>This means that the <em>global error</em> goes like <span class="math notranslate nohighlight">\(\approx O(h^2)\)</span>.
The trapezoidal reads then</p>
<!-- Equation labels as ordinary links -->
<div id="eq:trapez1"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
   I=\int_a^bf(x) dx=h\left(f(a)/2 + f(a+h) +f(a+2h)+
                          \dots +f(b-h)+ f_{b}/2\right),
\label{eq:trapez1} \tag{21}
\end{equation}
\]</div>
<p>with a global error which goes like <span class="math notranslate nohighlight">\(O(h^2)\)</span>.</p>
<p>Hereafter we use the shorthand notations <span class="math notranslate nohighlight">\(f_{-h}=f(x_0-h)\)</span>, <span class="math notranslate nohighlight">\(f_{0}=f(x_0)\)</span>
and <span class="math notranslate nohighlight">\(f_{h}=f(x_0+h)\)</span>.</p>
</div>
<div class="section" id="error-in-the-trapezoidal-rule">
<h2><span class="section-number">3.26. </span>Error in the trapezoidal rule<a class="headerlink" href="#error-in-the-trapezoidal-rule" title="Permalink to this headline">¶</a></h2>
<p>The correct mathematical expression for the local error for the trapezoidal rule is</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -\frac{b-a}{2}\left[f(a)+f(b)\right]=-\frac{h^3}{12}f^{(2)}(\xi),
\]</div>
<p>and the global error reads</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -T_h(f)=-\frac{b-a}{12}h^2f^{(2)}(\xi),
\]</div>
<p>where <span class="math notranslate nohighlight">\(T_h\)</span> is the trapezoidal result and <span class="math notranslate nohighlight">\(\xi \in [a,b]\)</span>.</p>
</div>
<div class="section" id="algorithm-for-the-trapezoidal-rule">
<h2><span class="section-number">3.27. </span>Algorithm for the trapezoidal rule<a class="headerlink" href="#algorithm-for-the-trapezoidal-rule" title="Permalink to this headline">¶</a></h2>
<p>The trapezoidal rule is easy to  implement numerically
through the following simple algorithm</p>
<ul class="simple">
<li><p>Choose the number of mesh points and fix the step length.</p></li>
<li><p>calculate <span class="math notranslate nohighlight">\(f(a)\)</span> and <span class="math notranslate nohighlight">\(f(b)\)</span> and multiply with <span class="math notranslate nohighlight">\(h/2\)</span>.</p></li>
<li><p>Perform a loop over <span class="math notranslate nohighlight">\(n=1\)</span> to <span class="math notranslate nohighlight">\(n-1\)</span> (<span class="math notranslate nohighlight">\(f(a)\)</span> and <span class="math notranslate nohighlight">\(f(b)\)</span> are known) and sum up  the terms <span class="math notranslate nohighlight">\(f(a+h) +f(a+2h)+f(a+3h)+\dots +f(b-h)\)</span>. Each step in the loop  corresponds to a given value <span class="math notranslate nohighlight">\(a+nh\)</span>.</p></li>
<li><p>Multiply the final result by <span class="math notranslate nohighlight">\(h\)</span> and add <span class="math notranslate nohighlight">\(hf(a)/2\)</span> and <span class="math notranslate nohighlight">\(hf(b)/2\)</span>.</p></li>
</ul>
</div>
<div class="section" id="trapezoidal-rule">
<h2><span class="section-number">3.28. </span>Trapezoidal Rule<a class="headerlink" href="#trapezoidal-rule" title="Permalink to this headline">¶</a></h2>
<p>We use the same function and integrate now using the trapoezoidal rule.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">integrate</span>
<span class="c1"># function for the trapezoidal rule</span>
<span class="k">def</span> <span class="nf">Trapez</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
   <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">a</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
       <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">h</span>
       <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">+</span><span class="n">s</span>
   <span class="k">return</span> <span class="n">h</span><span class="o">*</span><span class="n">s</span>
<span class="c1"># function to integrate</span>
<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># define integration limits and integration points                                                                         </span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">Exact</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relative error= &quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">Trapez</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">Exact</span><span class="p">)</span><span class="o">/</span><span class="n">Exact</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Relative error=  8.224805627923717e-05
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="simpsons-rule">
<h2><span class="section-number">3.29. </span>Simpsons’ rule<a class="headerlink" href="#simpsons-rule" title="Permalink to this headline">¶</a></h2>
<p>Instead of using the above first-order polynomials
approximations for <span class="math notranslate nohighlight">\(f\)</span>, we attempt at using a second-order polynomials.
In this case we need three points in order to define a second-order
polynomial approximation</p>
<div class="math notranslate nohighlight">
\[
f(x) \approx P_2(x)=a_0+a_1x+a_2x^2.
\]</div>
<p>Using again Lagrange’s interpolation formula we have</p>
<div class="math notranslate nohighlight">
\[
P_2(x)=\frac{(x-x_0)(x-x_1)}{(x_2-x_0)(x_2-x_1)}y_2+
            \frac{(x-x_0)(x-x_2)}{(x_1-x_0)(x_1-x_2)}y_1+
            \frac{(x-x_1)(x-x_2)}{(x_0-x_1)(x_0-x_2)}y_0.
\]</div>
<p>Inserting this formula in the integral of Eq.  (<a class="reference external" href="#eq:hhint">18</a>) we obtain</p>
<div class="math notranslate nohighlight">
\[
\int_{-h}^{+h}f(x)dx=\frac{h}{3}\left(f_h + 4f_0 + f_{-h}\right)+O(h^5),
\]</div>
<p>which is Simpson’s rule.</p>
</div>
<div class="section" id="simpson-s-rule">
<h2><span class="section-number">3.30. </span>Simpson’s rule<a class="headerlink" href="#simpson-s-rule" title="Permalink to this headline">¶</a></h2>
<p>Note that the improved accuracy in the evaluation of
the derivatives gives a better error approximation, <span class="math notranslate nohighlight">\(O(h^5)\)</span> vs.\ <span class="math notranslate nohighlight">\(O(h^3)\)</span> .
But this is again the <em>local error approximation</em>.
Using Simpson’s rule we can easily compute
the integral     of Eq.  (<a class="reference external" href="#eq:integraldef">17</a>) to be</p>
<!-- Equation labels as ordinary links -->
<div id="eq:simpson"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
   I=\int_a^bf(x) dx=\frac{h}{3}\left(f(a) + 4f(a+h) +2f(a+2h)+
                          \dots +4f(b-h)+ f_{b}\right),
\label{eq:simpson} \tag{22}
\end{equation}
\]</div>
<p>with a global error which goes like <span class="math notranslate nohighlight">\(O(h^4)\)</span>.</p>
</div>
<div class="section" id="mathematical-expressions-for-the-truncation-error">
<h2><span class="section-number">3.31. </span>Mathematical expressions for the truncation error<a class="headerlink" href="#mathematical-expressions-for-the-truncation-error" title="Permalink to this headline">¶</a></h2>
<p>More formal expressions for the local and global errors are for the local error</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -\frac{b-a}{6}\left[f(a)+4f((a+b)/2)+f(b)\right]=-\frac{h^5}{90}f^{(4)}(\xi),
\]</div>
<p>and for the global error</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -S_h(f)=-\frac{b-a}{180}h^4f^{(4)}(\xi).
\]</div>
<p>with <span class="math notranslate nohighlight">\(\xi\in[a,b]\)</span> and <span class="math notranslate nohighlight">\(S_h\)</span> the results obtained with Simpson’s method.</p>
</div>
<div class="section" id="algorithm-for-simpson-s-rule">
<h2><span class="section-number">3.32. </span>Algorithm for Simpson’s rule<a class="headerlink" href="#algorithm-for-simpson-s-rule" title="Permalink to this headline">¶</a></h2>
<p>The method
can easily be implemented numerically through the following simple algorithm</p>
<ul class="simple">
<li><p>Choose the number of mesh points and fix the step.</p></li>
<li><p>calculate <span class="math notranslate nohighlight">\(f(a)\)</span> and <span class="math notranslate nohighlight">\(f(b)\)</span></p></li>
<li><p>Perform a loop over <span class="math notranslate nohighlight">\(n=1\)</span> to <span class="math notranslate nohighlight">\(n-1\)</span> (<span class="math notranslate nohighlight">\(f(a)\)</span> and <span class="math notranslate nohighlight">\(f(b)\)</span> are known) and sum up   the terms <span class="math notranslate nohighlight">\(4f(a+h) +2f(a+2h)+4f(a+3h)+\dots +4f(b-h)\)</span>. Each step in the loop  corresponds to a given value <span class="math notranslate nohighlight">\(a+nh\)</span>. Odd values of <span class="math notranslate nohighlight">\(n\)</span> give <span class="math notranslate nohighlight">\(4\)</span> as factor  while even values yield <span class="math notranslate nohighlight">\(2\)</span> as factor.</p></li>
<li><p>Multiply the final result by <span class="math notranslate nohighlight">\(\frac{h}{3}\)</span>.</p></li>
</ul>
</div>
<div class="section" id="code-example">
<h2><span class="section-number">3.33. </span>Code example<a class="headerlink" href="#code-example" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">integrate</span>
<span class="c1"># function for the trapezoidal rule                                                                                        </span>
<span class="k">def</span> <span class="nf">Simpson</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
   <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="nb">sum</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
       <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
   <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
   <span class="k">return</span> <span class="nb">sum</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mf">3.0</span>
<span class="c1"># function to integrate                                                                                                    </span>
<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># define integration limits and integration points                                                                         </span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">Exact</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relative error= &quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">Simpson</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">Exact</span><span class="p">)</span><span class="o">/</span><span class="n">Exact</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Relative error=  5.412252157986472e-09
</pre></div>
</div>
</div>
</div>
<p>We see that Simpson’s rule gives a much better estimation of the relative error with the same amount of points as we had for the Rectangle rule and the Trapezoidal rule.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="chapter3.html" title="previous page"><span class="section-number">2. </span>Basic Steps of Scientific Investigations</a>
    <a class='right-next' id="next-link" href="chapter5.html" title="next page"><span class="section-number">4. </span>Harmonic Oscillator</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Morten Hjorth-Jensen<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>