<!--
HTML file automatically generated from DocOnce source
(https://github.com/doconce/doconce/)
doconce format html week5.do.txt --pygments_html_style=default --html_style=bloodish --html_links_in_new_window --html_output=week5 --no_mako
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/doconce/doconce/" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Week 7 February 13-17: Finalization of importance sampling, start Gradient methods, steepest descent">
<title>Week 7 February 13-17: Finalization of importance sampling, start Gradient methods, steepest descent</title>
<style type="text/css">
/* bloodish style */
body {
  font-family: Helvetica, Verdana, Arial, Sans-serif;
  color: #404040;
  background: #ffffff;
}
h1 { font-size: 1.8em; color: #8A0808; }
h2 { font-size: 1.6em; color: #8A0808; }
h3 { font-size: 1.4em; color: #8A0808; }
h4 { font-size: 1.2em; color: #8A0808; }
a { color: #8A0808; text-decoration:none; }
tt { font-family: "Courier New", Courier; }
p { text-indent: 0px; }
hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
p.caption { width: 80%; font-style: normal; text-align: left; }
hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa; }div.highlight {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    line-height: 1.21429em;
}
div.cell {
    width: 100%;
    padding: 5px 5px 5px 0;
    margin: 0;
    outline: none;
}
div.input {
    page-break-inside: avoid;
    box-orient: horizontal;
    box-align: stretch;
    display: flex;
    flex-direction: row;
    align-items: stretch;
}
div.inner_cell {
    box-orient: vertical;
    box-align: stretch;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    box-flex: 1;
    flex: 1;
}
div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 4px;
    background: #f7f7f7;
    line-height: 1.21429em;
}
div.input_area > div.highlight {
    margin: .4em;
    border: none;
    padding: 0;
    background-color: transparent;
}
div.output_wrapper {
    position: relative;
    box-orient: vertical;
    box-align: stretch;
    display: flex;
    flex-direction: column;
    align-items: stretch;
}
.output {
    box-orient: vertical;
    box-align: stretch;
    display: flex;
    flex-direction: column;
    align-items: stretch;
}
div.output_area {
    padding: 0;
    page-break-inside: avoid;
    box-orient: horizontal;
    box-align: stretch;
    display: flex;
    flex-direction: row;
    align-items: stretch;
}
div.output_subarea {
    padding: .4em .4em 0 .4em;
    box-flex: 1;
    flex: 1;
}
div.output_text {
    text-align: left;
    color: #000;
    line-height: 1.21429em;
}
.alert-text-small   { font-size: 80%;  }
.alert-text-large   { font-size: 130%; }
.alert-text-normal  { font-size: 90%;  }
.alert {
  padding:8px 35px 8px 14px; margin-bottom:18px;
  text-shadow:0 1px 0 rgba(255,255,255,0.5);
  border:1px solid #bababa;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  color: #555;
  background-color: #f8f8f8;
  background-position: 10px 5px;
  background-repeat: no-repeat;
  background-size: 38px;
  padding-left: 55px;
  width: 75%;
 }
.alert-block {padding-top:14px; padding-bottom:14px}
.alert-block > p, .alert-block > ul {margin-bottom:1em}
.alert li {margin-top: 1em}
.alert-block p+p {margin-top:5px}
.alert-notice { background-image: url(https://cdn.rawgit.com/doconce/doconce/master/bundled/html_images/small_gray_notice.png); }
.alert-summary  { background-image:url(https://cdn.rawgit.com/doconce/doconce/master/bundled/html_images/small_gray_summary.png); }
.alert-warning { background-image: url(https://cdn.rawgit.com/doconce/doconce/master/bundled/html_images/small_gray_warning.png); }
.alert-question {background-image:url(https://cdn.rawgit.com/doconce/doconce/master/bundled/html_images/small_gray_question.png); }
div { text-align: justify; text-justify: inter-word; }
.tab {
  padding-left: 1.5em;
}
div.toc p,a {
  line-height: 1.3;
  margin-top: 1.1;
  margin-bottom: 1.1;
}
</style>
</head>

<!-- tocinfo
{'highest level': 2,
 'sections': [('Overview of week 7, February 13-17',
               2,
               None,
               'overview-of-week-7-february-13-17'),
              ('Importance sampling', 2, None, 'importance-sampling'),
              ('Motivation', 2, None, 'motivation'),
              ('Simple example and demonstration',
               2,
               None,
               'simple-example-and-demonstration'),
              ('Simple example and demonstration',
               2,
               None,
               'simple-example-and-demonstration'),
              ('Exercise 1: Find the local energy for the harmonic oscillator',
               2,
               None,
               'exercise-1-find-the-local-energy-for-the-harmonic-oscillator'),
              ('Variance in the simple model',
               2,
               None,
               'variance-in-the-simple-model'),
              ('Computing the derivatives',
               2,
               None,
               'computing-the-derivatives'),
              ('Expressions for finding the derivatives of the local energy',
               2,
               None,
               'expressions-for-finding-the-derivatives-of-the-local-energy'),
              ('Derivatives of the local energy',
               2,
               None,
               'derivatives-of-the-local-energy'),
              ('Exercise 2: General expression for the derivative of the '
               'energy',
               2,
               None,
               'exercise-2-general-expression-for-the-derivative-of-the-energy')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- ------------------- main content ---------------------- -->
<center>
<h1>Week 7 February 13-17: Finalization of importance sampling, start Gradient methods, steepest descent</h1>
</center>  <!-- document title -->

<!-- author(s): Morten Hjorth-Jensen  Email morten.hjorth-jensen@fys.uio.no -->
<center>
<b>Morten Hjorth-Jensen  Email morten.hjorth-jensen@fys.uio.no</b> [1, 2]
</center>
<!-- institution(s) -->
<center>
[1] <b>Department of Physics and Center fo Computing in Science Education, University of Oslo, Oslo, Norway</b>
</center>
<center>
[2] <b>Department of Physics and Astronomy and Facility for Rare Ion Beams, Michigan State University, East Lansing, Michigan, USA</b>
</center>
<br>
<center>
<h4>February 13-17</h4>
</center> <!-- date -->
<br>

<!-- !split --><br><br><br><br><br><br><br><br><br><br>
<h2 id="overview-of-week-7-february-13-17">Overview of week 7, February 13-17 </h2>
<div class="alert alert-block alert-block alert-text-normal">
<b>Topics</b>
<p>
<ul>
<li> Finalize discussion on importance sampling and Fokker-Planck and Langevin equations</li>
<li> Gradient Descent methods, getting started</li>
</ul>
</div>


<div class="alert alert-block alert-block alert-text-normal">
<b>Teaching Material, videos and written material</b>
<p>
<ul>
<li> On importance sampling, see notes from last week at <a href="http://compphysics.github.io/ComputationalPhysics2/doc/pub/week4/html/week4-reveal.html" target="_blank"><tt>http://compphysics.github.io/ComputationalPhysics2/doc/pub/week4/html/week4-reveal.html</tt></a></li>
<li> These lecture notes</li>
<li> Recommended background literature, <a href="https://web.stanford.edu/~boyd/cvxbook/" target="_blank">Convex Optimization</a> by Boyd and Vandenberghe. Their <a href="https://web.stanford.edu/~boyd/cvxbook/bv_cvxslides.pdf" target="_blank">lecture slides</a> are very useful (warning, these are some 300 pages).</li>
<li> <a href="https://youtu.be/" target="_blank">Video of lecture TBA</a></li>
<li> <a href="https://github.com/CompPhysics/ComputationalPhysics2/blob/gh-pages/doc/HandWrittenNotes/2023/NotesFebruary16.pdf" target="_blank">Handwritten notes</a></li>
</ul>
</div>


<!-- !split --><br><br><br><br><br><br><br><br><br><br>
<h2 id="importance-sampling">Importance sampling </h2>

<p>Here we will use the material from the previous week, see the <a href="https://github.com/CompPhysics/ComputationalPhysics2/blob/gh-pages/doc/pub/week4/ipynb/week4.ipynb" target="_blank">Jupyter-notebook</a></p>

<!-- !split --><br><br><br><br><br><br><br><br><br><br>
<h2 id="motivation">Motivation  </h2>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
<p>Our aim with this part of the project is to be able to</p>
<ul>
<li> find an optimal value for the variational parameters using only some few Monte Carlo cycles</li>
<li> use these optimal values for the variational parameters to perform a large-scale Monte Carlo calculation</li>
</ul>
<p>To achieve this will look at methods like standard <em>Gradtient Descent</em>, <em>Sochastic gradient descent</em>, <em>Stochastic reconfigurations</em>, <em>Steepest descent</em> and the <em>conjugate gradient method</em>. All these methods allow us to find
the minima of a multivariable  function like our energy (function of several variational parameters). 
Alternatively, you can always use Newton's method. In particular, since we will normally have one variational parameter,
Newton's method can be easily used in finding the minimum of the local energy. However, as we will see, the latter requires that we can evaluate the second derivative of the energy with respect to the variational parameters.
</p>
</div>


<!-- !split --><br><br><br><br><br><br><br><br><br><br>
<h2 id="simple-example-and-demonstration">Simple example and demonstration </h2>

<p>Let us illustrate what is needed in our calculations using a simple example, the harmonic oscillator in one dimension.
For the harmonic oscillator in one-dimension we have a  trial wave function and probability
</p>
$$
\psi_T(x;\alpha) = \exp{-(\frac{1}{2}\alpha^2x^2)},
$$

<p>which results in a local energy </p>
$$
\frac{1}{2}\left(\alpha^2+x^2(1-\alpha^4)\right).
$$

<p>We can compare our numerically calculated energies with the exact energy as function of \( \alpha \)</p>
$$
\overline{E}[\alpha] = \frac{1}{4}\left(\alpha^2+\frac{1}{\alpha^2}\right).
$$


<!-- !split --><br><br><br><br><br><br><br><br><br><br>
<h2 id="simple-example-and-demonstration">Simple example and demonstration </h2>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
<p>The derivative of the energy with respect to \( \alpha \) gives</p>
$$
\begin{equation*}
\frac{d\langle  E_L[\alpha]\rangle}{d\alpha} = \frac{1}{2}\alpha-\frac{1}{2\alpha^3}
\end{equation*}
$$

<p>and a second derivative which is always positive (meaning that we find a minimum)</p>
$$
\begin{equation*}
\frac{d^2\langle  E_L[\alpha]\rangle}{d\alpha^2} = \frac{1}{2}+\frac{3}{2\alpha^4}
\end{equation*}
$$

<p>The condition</p>
$$
\begin{equation*}
\frac{d\langle  E_L[\alpha]\rangle}{d\alpha} = 0,
\end{equation*}
$$

<p>gives the optimal \( \alpha=1 \), as expected.</p>
</div>


<!-- !split --><br><br><br><br><br><br><br><br><br><br>

<!-- --- begin exercise --- -->
<h2 id="exercise-1-find-the-local-energy-for-the-harmonic-oscillator">Exercise 1: Find the local energy for the harmonic oscillator </h2>

<!-- --- begin subexercise --- -->
<p>
<b>a)</b>
Derive the local energy for the harmonic oscillator in one dimension and find its expectation value.
</p>

<!-- --- end subexercise --- -->

<!-- --- begin subexercise --- -->
<p>
<b>b)</b>
Show also that the optimal value of optimal \( \alpha=1 \)
</p>

<!-- --- end subexercise --- -->

<!-- --- begin subexercise --- -->
<p>
<b>c)</b>
Repeat the above steps in two dimensions for \( N \) bosons or electrons. What is the optimal value of \( \alpha \)?
</p>

<!-- --- end subexercise --- -->

<!-- --- end exercise --- -->

<!-- !split --><br><br><br><br><br><br><br><br><br><br>
<h2 id="variance-in-the-simple-model">Variance in the simple model </h2>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
<p>We can also minimize the variance. In our simple model the variance is</p>

$$
\sigma^2[\alpha]=\frac{1}{4}\left(1+(1-\alpha^4)^2\frac{3}{4\alpha^4}\right)-\overline{E}^2.
$$

<p>which yields a second derivative which is always positive.</p>
</div>


<!-- !split --><br><br><br><br><br><br><br><br><br><br>
<h2 id="computing-the-derivatives">Computing the derivatives </h2>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<p>In general we end up computing the expectation value of the energy in terms 
of some parameters \( \alpha_0,\alpha_1,\dots,\alpha_n \)
and we search for a minimum in this multi-variable parameter space.  
This leads to an energy minimization problem <em>where we need the derivative of the energy as a function of the variational parameters</em>.
</p>

<p>In the above example this was easy and we were able to find the expression for the derivative by simple derivations. 
However, in our actual calculations the energy is represented by a multi-dimensional integral with several variational parameters.
How can we can then obtain the derivatives of the energy with respect to the variational parameters without having 
to resort to expensive numerical derivations? 
</p>
</div>


<!-- !split --><br><br><br><br><br><br><br><br><br><br>
<h2 id="expressions-for-finding-the-derivatives-of-the-local-energy">Expressions for finding the derivatives of the local energy </h2>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<p>To find the derivatives of the local energy expectation value as function of the variational parameters, we can use the chain rule and the hermiticity of the Hamiltonian.  </p>

<p>Let us define </p>
$$
\bar{E}_{\alpha}=\frac{d\langle  E_L[\alpha]\rangle}{d\alpha}.
$$

<p>as the derivative of the energy with respect to the variational parameter \( \alpha \) (we limit ourselves to one parameter only).
In the above example this was easy and we obtain a simple expression for the derivative.
We define also the derivative of the trial function (skipping the subindex \( T \)) as 
</p>
$$
\bar{\psi}_{\alpha}=\frac{d\psi[\alpha]\rangle}{d\alpha}.
$$
</div>


<!-- !split --><br><br><br><br><br><br><br><br><br><br>
<h2 id="derivatives-of-the-local-energy">Derivatives of the local energy </h2>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
<p>The elements of the gradient of the local energy are then (using the chain rule and the hermiticity of the Hamiltonian)</p>
$$
\bar{E}_{\alpha} = 2\left( \langle \frac{\bar{\psi}_{\alpha}}{\psi[\alpha]}E_L[\alpha]\rangle -\langle \frac{\bar{\psi}_{\alpha}}{\psi[\alpha]}\rangle\langle E_L[\alpha] \rangle\right).
$$

<p>From a computational point of view it means that you need to compute the expectation values of </p>
$$
\langle \frac{\bar{\psi}_{\alpha}}{\psi[\alpha]}E_L[\alpha]\rangle,
$$

<p>and</p>
$$
\langle \frac{\bar{\psi}_{\alpha}}{\psi[\alpha]}\rangle\langle E_L[\alpha]\rangle
$$
</div>


<!-- !split --><br><br><br><br><br><br><br><br><br><br>

<!-- --- begin exercise --- -->
<h2 id="exercise-2-general-expression-for-the-derivative-of-the-energy">Exercise 2: General expression for the derivative of the energy </h2>

<!-- --- begin subexercise --- -->
<p>
<b>a)</b>
Show that 
</p>
$$
\bar{E}_{\alpha} = 2\left( \langle \frac{\bar{\psi}_{\alpha}}{\psi[\alpha]}E_L[\alpha]\rangle -\langle \frac{\bar{\psi}_{\alpha}}{\psi[\alpha]}\rangle\langle E_L[\alpha] \rangle\right).
$$


<!-- --- end subexercise --- -->

<!-- --- begin subexercise --- -->
<p>
<b>b)</b>
Find the corresponding expression for the variance.
</p>

<!-- --- end subexercise --- -->

<!-- --- end exercise --- -->
<!-- ------------------- end of main content --------------- -->
<center style="font-size:80%">
<!-- copyright --> &copy; 1999-2023, Morten Hjorth-Jensen  Email morten.hjorth-jensen@fys.uio.no. Released under CC Attribution-NonCommercial 4.0 license
</center>
</body>
</html>

